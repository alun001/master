window.__require=function t(e,r,i){function c(o,n){if(!r[o]){if(!e[o]){var s=o.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!n&&l)return l(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+o+"'")}}var h=r[o]={exports:{}};e[o][0].call(h.exports,function(t){return c(e[o][1][t]||t)},h,h.exports,t,e,r,i)}return r[o].exports}for(var a="function"==typeof __require&&__require,o=0;o<i.length;o++)c(i[o]);return c}({Comm:[function(t,e,r){"use strict";cc._RF.push(e,"1d260IA5QhB5Lx5Sb8wIrja","Comm");var i=t("./prefab/TipPrefab.js"),c=t("./prefab/ConfirmDialogPrefab.js");e.exports={gridSize:10,calcClearScore:function(t){return t*t*5},calcLastScore:function(t){return Math.max(0,2e3-t*t*20)},tip:function(t){console.log("tip"),cc.loader.loadRes("prefab/TipPrefab",function(e,r){if(e)console.log(e);else{var c=cc.instantiate(r);cc.director.getScene().addChild(c),c.getComponent(i).show(t)}})},confirm:function(t,e,r,i,a,o){console.log("confirm"),cc.loader.loadRes("prefab/ConfirmDialogPrefab",function(n,s){if(n)console.log(n);else{var l=cc.instantiate(s);cc.director.getScene().addChild(l),l.getComponent(c).show(t,e,r,i,a,o)}})},readLevelScores:function(){var t=cc.sys.localStorage.getItem("LEVEL_SCORES");this.levelScores=t?JSON.parse(t):{}},saveLevelScores:function(){var t=JSON.stringify(this.levelScores);cc.sys.localStorage.setItem("LEVEL_SCORES",t)},calcScoreLogic:function(){for(var t in this.totalScore=0,this.minScoreLevel=0,this.min2ScoreLevel=0,this.levelScores){var e=this.levelScores[t];this.totalScore+=e}var r=0;for(console.log(this.totalScore,this.calcTargetScore(r));this.totalScore>=this.calcTargetScore(r);)r++;this.maxLevel=r;var i=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY;for(t=1;t<=this.maxLevel;t++){(e=this.levelScores[t.toString()])||(e=0),e<i||e==i&&this.minScoreLevel>t?(i=e,this.min2ScoreLevel=this.minScoreLevel,this.minScoreLevel=t):(e<c||e==c&&this.min2ScoreLevel>t)&&(c=e,this.min2ScoreLevel=t)}},calcTargetScore:function(t){if(this.levelCfg||(this.levelCfg={}),this.levelCfg[t.toString()])return this.levelCfg[t.toString()];var e=1e3;return t>1?(e=this.calcTargetScore(t-1),e+=0==e%2?2e3:3e3,e+=300*Math.floor(t/10)):0==t&&(e=0),this.levelCfg[t.toString()]=e,e},setLevelScore:function(t,e){console.log("setLevelScore",t,e),this.levelScores[t.toString()]=e},calcTargetStr:function(){this.targetStrTab={};var t=0;this.min2ScoreLevel&&0!=this.min2ScoreLevel&&((t=this.levelScores[this.min2ScoreLevel])?t++:t=0);var e=0;if(this.maxLevel){var r=this.levelScores[this.currentLevel];r||(r=0),e=this.calcTargetScore(this.maxLevel)-(this.totalScore-r)}t>e?e>0?(this.targetStrTab.littleTarget=e,this.targetStrTab.littleTargetStr="(\u89e3\u9501\u7b2c"+(this.maxLevel+1)+"\u5173)\n",this.targetStrTab.bigTarget=t,this.targetStrTab.bigTargetStr="(\u8d85\u8fc7\u7b2c"+this.min2ScoreLevel+"\u5173)"):(this.targetStrTab.oneTarget=t,this.targetStrTab.oneTargetStr="(\u8d85\u8fc7\u7b2c"+this.min2ScoreLevel+"\u5173)"):t>0?(this.targetStrTab.littleTarget=t,this.targetStrTab.littleTargetStr="(\u8d85\u8fc7\u7b2c"+this.min2ScoreLevel+"\u5173)",this.targetStrTab.bigTarget=e,this.targetStrTab.bigTargetStr="(\u89e3\u9501\u7b2c"+(this.maxLevel+1)+"\u5173)\n"):(this.targetStrTab.oneTarget=e,this.targetStrTab.oneTargetStr="(\u89e3\u9501\u7b2c"+(this.maxLevel+1)+"\u5173)\n")}},cc._RF.pop()},{"./prefab/ConfirmDialogPrefab.js":"ConfirmDialogPrefab","./prefab/TipPrefab.js":"TipPrefab"}],ConfirmDialogPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"c7199ySzr1IhI7NQxciQpOR","ConfirmDialogPrefab"),cc.Class({extends:cc.Component,properties:{titleLabel:cc.Label,contentLabel:cc.Label,btn1Node:cc.Node,btn2Node:cc.Node,btn1Label:cc.Label,btn2Label:cc.Label},show:function(t,e,r,i,c,a){this.titleLabel.string=t,this.contentLabel.string=e,this.btn1Label.string=r,this.btn1Cb=i,c?(this.btn2Label.string=c,this.btn2Cb=a):(this.btn1Node.x=0,this.btn2Node.active=!1)},btn1Click:function(){this.btn1Cb(),this.node.destroy()},btn2Click:function(){this.btn2Cb(),this.node.destroy()},fullScreenBtnClick:function(){console.log("fullScreenBtnClick")},dialogBtnClick:function(){console.log("dialogBtnClick")}}),cc._RF.pop()},{}],GameScene:[function(t,e,r){"use strict";cc._RF.push(e,"e3996EcHbNIBo8DcXtt3l87","GameScene");var i=t("../prefab/StarPrefab.js"),c=t("../Comm.js");cc.Class({extends:cc.Component,properties:{starPrefab:cc.Prefab,starGrid:cc.Node,scoreLabel:cc.Label,scorePreLabel:cc.Label,targetLabel:cc.Label},onLoad:function(){var t=this;this.starGame(),this.starGrid.on(cc.Node.EventType.TOUCH_START,function(e){var r=t.starGrid.convertToNodeSpace(e.touch.getLocation());t.touchStar(parseInt(r.x/(t.starGrid.width/10)),parseInt(r.y/(t.starGrid.height/10)))});var e=cc.director.getWinSize();this.scoreLabel.node.y=e.height/2-(e.height-e.width)/2/2,this.targetLabel.node.y=e.height/2-50},starGame:function(){this.initStatus(),this.initGrid(),c.calcTargetStr(),this.targetButtonClick(),this.updateTargetLabel()},initStatus:function(){this.stVar={},this.stVar.selected=!1,this.totalScore=0},initGrid:function(){if(this.gridStarUi)for(var t=0;t<c.gridSize;t++)for(var e=0;e<c.gridSize;e++)this.gridStarUi[t][e]&&this.gridStarUi[t][e].destroy();for(var r=[],a=[],o=0;o<c.gridSize;o++){r[o]=[],a[o]=[];for(var n=0;n<c.gridSize;n++){var s=cc.instantiate(this.starPrefab),l=s.getComponent(i);s.parent=this.starGrid,l.setGridXY(o,n);var h=parseInt(5*Math.random()+1);l.setType(h),r[o][n]=h,a[o][n]=s}}this.gridData=r,this.gridStarUi=a},updateTargetLabel:function(){c.targetStrTab.oneTarget?this.totalScore>=c.targetStrTab.oneTarget?this.targetLabel.string="\u76ee\u6807:"+c.targetStrTab.oneTarget+"\u5206(\u5df2\u5b8c\u6210)":this.targetLabel.string="\u76ee\u6807:"+c.targetStrTab.oneTarget+"\u5206":this.totalScore<c.targetStrTab.littleTarget?this.targetLabel.string="\u5c0f\u76ee\u6807:"+c.targetStrTab.littleTarget+"\u5206":this.totalScore<c.targetStrTab.bigTarget?this.targetLabel.string="\u5927\u76ee\u6807:"+c.targetStrTab.bigTarget+"\u5206":this.targetLabel.string="\u5927\u76ee\u6807:"+c.targetStrTab.bigTarget+"\u5206(\u5df2\u5b8c\u6210)"},touchStar:function(t,e){if(this.stVar.selected)this.connectContain(t,e)?(this.cleanOnce(t,e),this.stVar.selected=!1):(this.setConnectStarSelect(!1),this.scorePreLabel.node.active=!1,this.touchStar(t,e));else{if(0==this.gridData[t][e])return;this.stVar.connectStars=[[t,e]],this.checkStar(t,e),this.stVar.connectStars.length>=2&&(this.setConnectStarSelect(!0),this.scorePreLabel.string=c.calcClearScore(this.stVar.connectStars.length),this.scorePreLabel.node.stopAllActions(),this.scorePreLabel.node.setPosition(this.gridStarUi[t][e].position),this.scorePreLabel.node.opacity=255,this.scorePreLabel.fontSize=32,this.scorePreLabel.node.active=!0)}},checkStar:function(t,e){for(var r=this.gridData[t][e],i=[[t+1,e],[t-1,e],[t,e-1],[t,e+1]],c=i.length-1;c>=0;c--){var a=i[c][0],o=i[c][1];this.inGrid(a,o)&&this.gridData[a][o]==r&&!this.connectContain(a,o)&&(this.stVar.connectStars[this.stVar.connectStars.length]=[a,o],this.checkStar(a,o))}},inGrid:function(t,e){return t>=0&&t<c.gridSize&&e>=0&&e<c.gridSize},connectContain:function(t,e){for(var r=this.stVar.connectStars.length-1;r>=0;r--){var i=this.stVar.connectStars[r];if(i[0]==t&&i[1]==e)return!0}return!1},setConnectStarSelect:function(t){for(var e=this.stVar.connectStars.length-1;e>=0;e--){var r=this.stVar.connectStars[e];this.gridStarUi[r[0]][r[1]].getComponent(i).setSelected(t)}this.stVar.selected=t},cleanOnce:function(){if(this.scorePreLabel.fontSize=64,this.scorePreLabel.node.runAction(cc.sequence(cc.moveBy(.2,cc.p(0,20)),cc.delayTime(.8),cc.spawn(cc.moveBy(.2,cc.p(0,10)),cc.fadeOut(.2)))),this.totalScore+=parseInt(this.scorePreLabel.string),this.scoreLabel.string=this.totalScore,this.updateTargetLabel(),this.clearConnectStar(),this.fallDownStar(),this.fallLeftStar(),this.checkOver()){console.log("\u4e0d\u80fd\u518d\u6d88\u9664\u4e86");var t=this.checkCount(),e=c.calcLastScore(t);this.totalScore+=e,this.scoreLabel.string=this.totalScore,console.log("\u8ba1\u7b97\u5269\u4f59\u661f\u661f\u5206"),console.log("\u6700\u7ec8\u5f97\u5206",this.totalScore);var r="";if(c.targetStrTab.oneTarget){var i="\u5df2\u5b8c\u6210";this.totalScore<c.targetStrTab.oneTarget&&(i="\u672a\u5b8c\u6210"),r="\u76ee\u6807:"+c.targetStrTab.oneTarget+"\u5206"+c.targetStrTab.oneTargetStr+i}else{var a="\u5df2\u5b8c\u6210";this.totalScore<c.targetStrTab.littleTarget&&(a="\u672a\u5b8c\u6210");var o="\u5df2\u5b8c\u6210";this.totalScore<c.targetStrTab.bigTarget&&(o="\u672a\u5b8c\u6210"),r="\u5c0f\u76ee\u6807:"+c.targetStrTab.littleTarget+"\u5206"+c.targetStrTab.littleTargetStr+a+"\n\u5927\u76ee\u6807:"+c.targetStrTab.bigTarget+"\u5206"+c.targetStrTab.bigTargetStr+o}var n=c.levelScores[c.currentLevel.toString()];(!n||this.totalScore>n)&&(console.log("\u7834\u8bb0\u5f55\u4e86"),c.setLevelScore(c.currentLevel,this.totalScore),c.saveLevelScores(),c.calcScoreLogic()),c.confirm("\u4e0d\u80fd\u518d\u6d88\u9664\u4e86","\u60a8\u7684\u5f97\u5206:"+this.totalScore+"(\u5176\u4e2d\u5269\u4f59\u661f\u661f"+t+"\u9644\u52a0\u5206:"+e+")","\u786e\u5b9a",function(){c.confirm("\u76ee\u6807",r,"\u56de\u4e3b\u83dc\u5355",function(){cc.director.loadScene("MainScene")})})}},clearConnectStar:function(){for(var t=this.stVar.connectStars.length-1;t>=0;t--){var e=this.stVar.connectStars[t];this.gridData[e[0]][e[1]]=0,this.gridStarUi[e[0]][e[1]].destroy()}},fallDownStar:function(){for(var t=0;t<c.gridSize;t++)for(var e=0,r=0;r<c.gridSize;r++)0==this.gridData[t][r]&&e++,e>0&&this.gridData[t][r]>0&&(this.gridData[t][r-e]=this.gridData[t][r],this.gridData[t][r]=0,this.gridStarUi[t][r].getComponent(i).goTo(t,r-e,0),this.gridStarUi[t][r-e]=this.gridStarUi[t][r],this.gridStarUi[t][r]=null)},fallLeftStar:function(){for(var t=0,e=0;e<c.gridSize;e++)if(0==this.gridData[e][0]&&t++,0!=this.gridData[e][0]&&0!=t)for(var r=0;r<c.gridSize&&this.gridData[e][r]>0;r++)this.gridData[e-t][r]=this.gridData[e][r],this.gridData[e][r]=0,this.gridStarUi[e][r].getComponent(i).goTo(e-t,r,.1),this.gridStarUi[e-t][r]=this.gridStarUi[e][r],this.gridStarUi[e][r]=null},checkOver:function(){for(var t=0;t<c.gridSize;t++)for(var e=0;e<c.gridSize;e++){var r=this.gridData[t][e];if(0==r)break;for(var i=[[t+1,e],[t-1,e],[t,e-1],[t,e+1]],a=0;a<i.length;a++){var o=i[a][0],n=i[a][1];if(this.inGrid(o,n)&&this.gridData[o][n]==r)return!1}}return!0},checkCount:function(){for(var t=0,e=0;e<c.gridSize;e++)for(var r=0;r<c.gridSize;r++){this.gridData[e][r]>0&&t++}return t},targetButtonClick:function(){var t="";t=c.targetStrTab.oneTarget?"\u76ee\u6807:"+c.targetStrTab.oneTarget+"\u5206"+c.targetStrTab.oneTargetStr:"\u5c0f\u76ee\u6807:"+c.targetStrTab.littleTarget+"\u5206"+c.targetStrTab.littleTargetStr+"\n\u5927\u76ee\u6807:"+c.targetStrTab.bigTarget+"\u5206"+c.targetStrTab.bigTargetStr,console.log(t),c.confirm("\u76ee\u6807",t,"\u786e\u5b9a",function(){})}}),cc._RF.pop()},{"../Comm.js":"Comm","../prefab/StarPrefab.js":"StarPrefab"}],LevelCurPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"046c9RjCshG748pEaUzb9At","LevelCurPrefab");var i=t("../Comm.js");cc.Class({extends:cc.Component,properties:{strLabel:cc.Label},setLevel:function(t){this.level=t;var e=i.levelScores[t.toString()];e||(e=0),this.strLabel.string="\u7b2c"+t+"\u5173 "+e+"\u5206"},mainButtonClick:function(){this.cb(this.level)},setClickCallback:function(t){this.cb=t}}),cc._RF.pop()},{"../Comm.js":"Comm"}],LevelPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"5c0b0KWY05MQIxdXOuvrjyk","LevelPrefab");var i=t("../Comm.js");cc.Class({extends:cc.Component,properties:{strLabel:cc.Label,lock:cc.Node},setLevel:function(t){this.level=t;var e=i.levelScores[t.toString()];e||(e=0),this.strLabel.string="\u7b2c"+t+"\u5173 "+e+"\u5206",this.lock.active=!1},setUnlockInfoForLevel:function(t){this.level=t,this.strLabel.string="\u603b\u5206"+i.calcTargetScore(this.level-1)+"\u89e3\u9501\u7b2c"+t+"\u5173",this.lock.active=!0},mainButtonClick:function(){this.cb(this.level)},setClickCallback:function(t){this.cb=t}}),cc._RF.pop()},{"../Comm.js":"Comm"}],MainScene:[function(t,e,r){"use strict";cc._RF.push(e,"04fb30nHQBA7J6o6i9uMytG","MainScene");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=t("../Comm.js"),a=t("../prefab/LevelPrefab.js"),o=t("../prefab/LevelCurPrefab.js");cc.Class({extends:cc.Component,properties:{levelLayout:cc.Node,levelPrefab:cc.Prefab,levelCurPrefab:cc.Prefab,totalScoreLabel:cc.Label,scrollView:cc.ScrollView},onLoad:function(){c.readLevelScores(),c.calcScoreLogic(),this.totalScoreLabel.string="\u603b\u5206:"+c.totalScore;for(var t=1;t<c.minScoreLevel;t++){(e=cc.instantiate(this.levelPrefab)).getComponent(a).setLevel(t),e.getComponent(a).setClickCallback(function(t){c.currentLevel=t,console.log("Comm.currentLevel",c.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(e)}(e=cc.instantiate(this.levelCurPrefab)).getComponent(o).setLevel(c.minScoreLevel),e.getComponent(o).setClickCallback(function(t){c.currentLevel=c.minScoreLevel,console.log("Comm.currentLevel",c.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(e);for(t=c.minScoreLevel+1;t<=c.maxLevel;t++){var e;(e=cc.instantiate(this.levelPrefab)).getComponent(a).setLevel(t),e.getComponent(a).setClickCallback(function(t){c.currentLevel=t,console.log("Comm.currentLevel",c.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(e)}if((e=cc.instantiate(this.levelPrefab)).getComponent(a).setUnlockInfoForLevel(c.maxLevel+1),e.getComponent(a).setClickCallback(function(t){c.tip("\u603b\u5206\u8fbe\u5230"+c.calcTargetScore(t-1)+"\u624d\u80fd\u73a9\u8fd9\u4e00\u5173")}),this.levelLayout.addChild(e),this.scheduleOnce(function(){var t=this.scrollView.getMaxScrollOffset(),e=Math.min(1,Math.max(0,(c.minScoreLevel-6)/(c.maxLevel+1-7)));console.log("percent",e),this.scrollView.scrollToOffset(cc.p(0,t.y*e),.3)},0),console.log("\u5f04\u4e00\u4e0b\u7edf\u8ba1\u7684\u4e1c\u897f"),console.log("typeof","undefined"==typeof anysdk?"undefined":i(anysdk)),"undefined"!=typeof anysdk){var r=anysdk.agentManager;if(console.log("agent",r),r){var n=r.getAnalyticsPlugin();console.log("user_plugin",n),n&&(n.setAccount&&n.setAccount({Account_Id:"123456",Account_Name:"test",Account_Type:anysdk.AccountType.ANONYMOUS.toString(),Account_Level:"0",Account_Age:"0",Account_Operate:anysdk.AccountOperate.LOGIN.toString(),Account_Gender:anysdk.AccountGender.UNKNOWN.toString(),Server_Id:"0"}),n.startSession&&n.startSession(),console.log("\u7edf\u8ba1\u7684\u4e1c\u897f\u5f04\u5b8c\u4e86"))}}},startButtonClick:function(){}}),cc._RF.pop()},{"../Comm.js":"Comm","../prefab/LevelCurPrefab.js":"LevelCurPrefab","../prefab/LevelPrefab.js":"LevelPrefab"}],StarPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"22bb0VNWAxF/ZMJwZXVIaIx","StarPrefab"),cc.Class({extends:cc.Component,properties:{pic1:cc.SpriteFrame,pic2:cc.SpriteFrame,pic3:cc.SpriteFrame,pic4:cc.SpriteFrame,pic5:cc.SpriteFrame},onLoad:function(){this.node.setScale(1.17)},setType:function(t){this.starType=t,this.getComponent(cc.Sprite).spriteFrame=this["pic"+t]},setGridXY:function(t,e){this.gridX=t,this.gridY=e,this.node.setPosition(75*(t-5)+37.5,75*(e-5)+37.5)},setSelected:function(t){t?this.node.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.3,1),cc.scaleTo(.3,1.17)))):(this.node.stopAllActions(),this.node.setScale(1.17))},goTo:function(t,e,r){this.gridX=t,this.gridY=e,this.node.runAction(cc.sequence(cc.delayTime(r),cc.moveTo(.1,cc.p(75*(t-5)+37.5,75*(e-5)+37.5))))}}),cc._RF.pop()},{}],TipPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"2fc39ba/flCCaXZ48+4ZaMH","TipPrefab"),cc.Class({extends:cc.Component,properties:{tipLabel:cc.Label,tipBg:cc.Node},show:function(t){var e=this;this.tipLabel.string=t,this.node.setPosition(cc.director.getWinSize().width/2,100),this.node.runAction(cc.sequence(cc.delayTime(2),cc.fadeOut(.3),cc.callFunc(function(){e.node.destroy()})))}}),cc._RF.pop()},{}]},{},["Comm","ConfirmDialogPrefab","LevelCurPrefab","LevelPrefab","StarPrefab","TipPrefab","GameScene","MainScene"]);